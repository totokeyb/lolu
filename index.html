<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Today is 今天</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
        }
        .container {
            margin-top: 20px;
        }
        .date, .zodiac, .weather, .random-image {
            margin: 20px;
        }
        .image {
            max-width: 300px;
            height: auto;
            cursor: pointer;
        }
        .zodiac img {
            width: 50px;
            height: 50px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="date" id="currentDate"></div>
        <div class="zodiac" id="zodiac">
            <h3>今天的星座</h3>
            <div id="zodiacImage">
                <img src="" alt="星座图片">
                <p id="zodiacName"></p>
            </div>
        </div>
        <div class="random-image">
            <h3>随机图片</h3>
            <img id="randomImage" class="image" src="https://source.unsplash.com/random/300x200" alt="随机图片">
        </div>
        <div class="weather" id="weather">
            <h3>天气情况</h3>
            <div id="weatherInfo"></div>
        </div>
    </div>

    <script>
        // 星座数据
        const zodiacSigns = {
            "摩羯座": {start: "12-22", end: "01-19", image: "https://www.astrology-zodiac-signs.com/images/capricorn.png"},
            "水瓶座": {start: "01-20", end: "02-18", image: "https://www.astrology-zodiac-signs.com/images/aquarius.png"},
            "双鱼座": {start: "02-19", end: "03-20", image: "https://www.astrology-zodiac-signs.com/images/pisces.png"},
            "白羊座": {start: "03-21", end: "04-19", image: "https://www.astrology-zodiac-signs.com/images/aries.png"},
            "金牛座": {start: "04-20", end: "05-20", image: "https://www.astrology-zodiac-signs.com/images/taurus.png"},
            "双子座": {start: "05-21", end: "06-20", image: "https://www.astrology-zodiac-signs.com/images/gemini.png"},
            "巨蟹座": {start: "06-21", end: "07-22", image: "https://www.astrology-zodiac-signs.com/images/cancer.png"},
            "狮子座": {start: "07-23", end: "08-22", image: "https://www.astrology-zodiac-signs.com/images/leo.png"},
            "处女座": {start: "08-23", end: "09-22", image: "https://www.astrology-zodiac-signs.com/images/virgo.png"},
            "天秤座": {start: "09-23", end: "10-22", image: "https://www.astrology-zodiac-signs.com/images/libra.png"},
            "天蝎座": {start: "10-23", end: "11-21", image: "https://www.astrology-zodiac-signs.com/images/scorpio.png"},
            "射手座": {start: "11-22", end: "12-21", image: "https://www.astrology-zodiac-signs.com/images/sagittarius.png"}
        };

        // 获取当前日期
        function getCurrentDate() {
            const today = new Date();
            const month = today.getMonth() + 1; // 获取月份（0-11）
            const day = today.getDate(); // 获取日期
            const dateStr = `${month}月${day}日`;
            document.getElementById('currentDate').innerHTML = `今天是: ${dateStr}`;
            return {month, day};
        }

        // 获取星座
        function getZodiac(month, day) {
            let zodiacName = "";
            let zodiacImage = "";
            for (const [name, dates] of Object.entries(zodiacSigns)) {
                const [startMonth, startDay] = dates.start.split('-').map(Number);
                const [endMonth, endDay] = dates.end.split('-').map(Number);

                if ((month > startMonth || (month === startMonth && day >= startDay)) && 
                    (month < endMonth || (month === endMonth && day <= endDay))) {
                    zodiacName = name;
                    zodiacImage = dates.image;
                    break;
                }
            }

            document.getElementById('zodiacName').textContent = zodiacName;
            document.querySelector('#zodiacImage img').src = zodiacImage;
        }

        // 获取天气信息
        async function getWeather() {
            const city = "大连";
            const url = `https://wttr.in/${city}?format=%C+%t+%w+%h+%P+%T&lang=zh`; // 使用wttr.in获取天气信息
            const response = await fetch(url);
            const data = await response.text();

            if (data) {
                // 正则匹配并提取天气信息
                const regex = /([\u4e00-\u9fa5]+)\s+([\d℃°]+)\s+(?:↗?(\d+km\/h)?)\s*(\d+%)\s*(\d+hPa)?\s*(\d{2}:\d{2}:\d{2})/;
                const match = data.match(regex);
                if (match) {
                    const description = match[1];  // 天气描述
                    const temperature = match[2];  // 温度
                    const wind = match[3];  // 风速
                    const humidity = match[4];  // 湿度
                    const pressure = match[5];  // 气压
                    const time = match[6];  // 更新时间

                    const weatherHTML = `
                        天气: ${description} <br>
                        温度: ${temperature} <br>
                        风速: ${wind} <br>
                        湿度: ${humidity} <br>
                        气压: ${pressure || '无'} <br>
                        更新时间: ${time}
                    `;
                    document.getElementById('weatherInfo').innerHTML = weatherHTML;
                } else {
                    document.getElementById('weatherInfo').innerHTML = "无法获取天气信息";
                }
            } else {
                document.getElementById('weatherInfo').innerHTML = "无法获取天气信息";
            }
        }

        // 点击随机图片刷新
        function changeRandomImage() {
            const randomImage = document.getElementById("randomImage");
            randomImage.src = "https://source.unsplash.com/random/300x200?" + new Date().getTime(); // 使用时间戳确保图片刷新
        }

        // 页面加载时执行
        function init() {
            const {month, day} = getCurrentDate();
            getZodiac(month, day);
            getWeather();
            changeRandomImage(); // 初始化随机图片
        }

        // 设置点击事件刷新随机图片
        document.getElementById("randomImage").addEventListener("click", changeRandomImage);

        init(); // 页面加载时初始化
    </script>
</body>
</html>
