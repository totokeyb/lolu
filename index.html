<!DOCTYPE html>
<html lang="zh">
<head>
    <!-- 你的头部内容保持不变 -->
</head>
<body>
    <!-- 你的 HTML 结构保持不变 -->

    <script>
        // 日期和星座、时间、名言、随机图片等代码保持不变，直到天气部分

        // 使用 OpenWeatherMap 获取天气信息
        const weatherElement = document.getElementById('weather');
        const city = 'Dalian';

        // 先从 Cloudflare Worker 获取 API 密钥
        fetch('https://term-1293.waitingkey.workers.dev') // 替换为你的 Worker URL
            .then(response => {
                if (!response.ok) {
                    throw new Error('无法获取 API 密钥');
                }
                return response.json();
            })
            .then(data => {
                const apiKey = data.apiKey; // 从 Worker 返回的 JSON 中获取密钥
                const weatherApiUrl = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric`;

                // 调用 OpenWeatherMap API
                return fetch(weatherApiUrl);
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`天气请求失败，状态码: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log("天气数据:", data); // 调试用，可删除
                if (!data.main || !data.weather) throw new Error("天气数据不完整");

                const temp = data.main.temp;
                const humidity = data.main.humidity;
                const windSpeed = data.wind.speed;
                const windDeg = data.wind.deg;
                const cloudiness = data.clouds.all;
                const feelsLike = data.main.feels_like;
                const pressure = data.main.pressure;
                const visibility = data.visibility / 1000;
                const rain = data.rain ? data.rain['1h'] || 0 : 0;
                const weatherMain = data.weather[0].main;
                const weatherDescription = data.weather[0].description;

                let temperatureLevel = temp <= -20 ? '极寒天气，极度寒冷' : temp <= -10 ? '寒冷天气，冬季寒冷' : temp <= 0 ? '较冷天气，寒冷' : temp <= 10 ? '凉爽天气，适合外出' : temp <= 20 ? '温暖天气，适宜外出' : temp <= 25 ? '温和天气，舒适宜人' : temp <= 30 ? '炎热天气，注意防暑' : '极热天气，注意高温中暑';
                let humidityLevel = humidity <= 20 ? '非常干燥' : humidity <= 40 ? '干燥' : humidity <= 60 ? '适宜' : humidity <= 80 ? '潮湿' : '非常潮湿';
                const windSpeedKmh = (windSpeed * 3.6).toFixed(1);
                let windLevel = windSpeedKmh <= 1 ? '0级（静风）' : windSpeedKmh <= 5 ? '1级（轻风）' : windSpeedKmh <= 11 ? '2级（微风）' : windSpeedKmh <= 19 ? '3级（和风）' : windSpeedKmh <= 28 ? '4级（清风）' : windSpeedKmh <= 38 ? '5级（强风）' : windSpeedKmh <= 49 ? '6级（很强的风）' : windSpeedKmh <= 61 ? '7级（强风）' : windSpeedKmh <= 74 ? '8级（疾风）' : windSpeedKmh <= 88 ? '9级（烈风）' : '10级及以上（暴风、大暴风等）';
                let cloudDescription = cloudiness <= 20 ? '晴' : cloudiness <= 50 ? '少云' : cloudiness <= 80 ? '多云' : '阴';

                let windDirection = '';
                if (windDeg >= 337.5 || windDeg < 22.5) windDirection = '北风';
                else if (windDeg >= 22.5 && windDeg < 67.5) windDirection = '东北风';
                else if (windDeg >= 67.5 && windDeg < 112.5) windDirection = '东风';
                else if (windDeg >= 112.5 && windDeg < 157.5) windDirection = '东南风';
                else if (windDeg >= 157.5 && windDeg < 202.5) windDirection = '南风';
                else if (windDeg >= 202.5 && windDeg < 247.5) windDirection = '西南风';
                else if (windDeg >= 247.5 && windDeg < 292.5) windDirection = '西风';
                else if (windDeg >= 292.5 && windDeg < 337.5) windDirection = '西北风';

                const weatherTranslations = {
                    'clear sky': '晴空',
                    'few clouds': '少云',
                    'scattered clouds': '疏云',
                    'broken clouds': '多云',
                    'overcast clouds': '阴天',
                    'light rain': '小雨',
                    'moderate rain': '中雨',
                    'heavy intensity rain': '大雨',
                    'shower rain': '阵雨',
                    'rain': '雨',
                    'thunderstorm': '雷雨',
                    'snow': '雪',
                    'light snow': '小雪',
                    'heavy snow': '大雪',
                    'mist': '薄雾',
                    'fog': '雾',
                    'haze': '霾'
                };

                const weatherIcons = {
                    '晴空': 'https://img.icons8.com/color/48/000000/sun.png',
                    '少云': 'https://img.icons8.com/color/48/000000/partly-cloudy-day.png',
                    '疏云': 'https://img.icons8.com/color/48/000000/partly-cloudy-day.png',
                    '多云': 'https://img.icons8.com/color/48/000000/cloud.png',
                    '阴天': 'https://img.icons8.com/color/48/000000/cloud.png',
                    '小雨': 'https://img.icons8.com/color/48/000000/light-rain.png',
                    '中雨': 'https://img.icons8.com/color/48/000000/rain.png',
                    '大雨': 'https://img.icons8.com/color/48/000000/heavy-rain.png',
                    '阵雨': 'https://img.icons8.com/color/48/000000/rain.png',
                    '雨': 'https://img.icons8.com/color/48/000000/rain.png',
                    '雷雨': 'https://img.icons8.com/color/48/000000/storm.png',
                    '雪': 'https://img.icons8.com/color/48/000000/snow.png',
                    '小雪': 'https://img.icons8.com/color/48/000000/snow.png',
                    '大雪': 'https://img.icons8.com/color/48/000000/snow-storm.png',
                    '薄雾': 'https://img.icons8.com/color/48/000000/fog.png',
                    '雾': 'https://img.icons8.com/color/48/000000/fog.png',
                    '霾': 'https://img.icons8.com/color/48/000000/haze.png'
                };

                const translatedWeather = weatherTranslations[weatherDescription.toLowerCase()] || weatherTranslations[weatherMain.toLowerCase()] || '未知天气';
                let weatherIcon = weatherIcons[translatedWeather] || 'https://img.icons8.com/color/48/000000/question-mark.png';

                weatherElement.innerHTML = `
                    天气：${translatedWeather} <img src="${weatherIcon}" alt="${translatedWeather}"><br>
                    气温：${temp}°C（${temperatureLevel}）<br>
                    体感温度：${feelsLike}°C<br>
                    湿度：${humidity}%（${humidityLevel}）<br>
                    风速：${windSpeedKmh} km/h（${windLevel}）<br>
                    风向：${windDirection} (${windDeg}°)<br>
                    云量：${cloudiness}%<br>
                    气压：${pressure} hPa<br>
                    能见度：${visibility} km<br>
                    降雨量（过去1小时）：${rain} mm
                `;
            })
            .catch(error => {
                console.error("天气加载失败:", error);
                weatherElement.innerHTML = `无法加载天气信息：${error.message}`;
            });

        // 背景颜色切换等其他代码保持不变
    </script>
</body>
</html>
